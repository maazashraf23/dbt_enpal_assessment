version: 2

models:
  - name: int_pipedrive_deal_stage_events
    description: >
      Deal stage change events derived from the Pipedrive deal change log,
      standardized to the funnel stage names.
    columns:
      - name: deal_id
        description: "{{ doc('deal_id') }}"
        tests:
          - not_null
      - name: changed_at
        description: "{{ doc('changed_at') }}"
        tests:
          - not_null
      - name: stage_id
        description: "{{ doc('stage_id') }}"
        tests:
          - not_null
      - name: stage_name
        description: "{{ doc('stage_name') }}"
      - name: funnel_stage_name
        description: "{{ doc('kpi_name') }}"

  - name: int_pipedrive_deal_stage_firsts
    description: >
      First time each deal entered a given stage.
    columns:
      - name: deal_id
        description: "{{ doc('deal_id') }}"
        tests:
          - not_null
      - name: stage_id
        description: "{{ doc('stage_id') }}"
        tests:
          - not_null
      - name: funnel_stage_name
        description: "{{ doc('kpi_name') }}"
      - name: stage_entered_at
        description: "{{ doc('stage_entered_at') }}"
        tests:
          - not_null
  - name: int_pipedrive_deal_sales_calls
    description: >
      First completed Sales Call 1 and Sales Call 2 activities per deal.
    columns:
      - name: deal_id
        description: "{{ doc('deal_id') }}"
        tests:
          - not_null
      - name: activity_type_name
        description: "{{ doc('activity_type_name') }}"
        tests:
          - not_null
      - name: first_call_at
        description: "{{ doc('first_call_at') }}"
        tests:
          - not_null

